Perdiz point shape as a function of site/raw material?
================
Robert Z. Selden, Jr.
25 September, 2020

# Elliptical Fourier Analysis

## Load packages + data

``` r
# load packages
library(here)
```

    ## here() starts at D:/github/perdiz

``` r
library(wesanderson)
library(Momocs)
```

    ## 
    ##   Momocs is now retired and will no longer be maintained.
    ##   It is superseded by Momocs2 and more generally MomX ecosystem:
    ## 
    ##              <   https://momx.github.io   >

    ## 
    ## Attaching package: 'Momocs'

    ## The following object is masked from 'package:stats':
    ## 
    ##     filter

``` r
# read images
jpg.list <- list.files(here("/img.perdiz"), full.names = TRUE)

# read attribute data
att.data <- read.csv("perdiz.csv", header = TRUE, as.is = TRUE)

# attribute to factor
att.data$type <- as.factor(att.data$type)
att.data$trinomial <- as.factor(att.data$trinomial)
att.data$raw.mat <- as.factor(att.data$raw.mat)
```

## Generate outlines

``` r
# generate outlines
outlines <- jpg.list %>%
  import_jpg()
```

    ## Extracting 64.jpg outlines...

    ## [ 1 / 64 ]  489.jpg
    ## [ 2 / 64 ]  490.jpg
    ## [ 3 / 64 ]  553.jpg
    ## [ 4 / 64 ]  554.jpg
    ## [ 5 / 64 ]  555.jpg
    ## [ 6 / 64 ]  556.jpg
    ## [ 7 / 64 ]  558.jpg
    ## [ 8 / 64 ]  559.jpg
    ## [ 9 / 64 ]  562.jpg
    ## [ 10 / 64 ]  565.jpg
    ## [ 11 / 64 ]  591.jpg
    ## [ 12 / 64 ]  598.jpg
    ## [ 13 / 64 ]  645.jpg
    ## [ 14 / 64 ]  646.jpg
    ## [ 15 / 64 ]  647.jpg
    ## [ 16 / 64 ]  648.jpg
    ## [ 17 / 64 ]  649.jpg
    ## [ 18 / 64 ]  650.jpg
    ## [ 19 / 64 ]  651.jpg
    ## [ 20 / 64 ]  652.jpg
    ## [ 21 / 64 ]  653.jpg
    ## [ 22 / 64 ]  654.jpg
    ## [ 23 / 64 ]  655.jpg
    ## [ 24 / 64 ]  656.jpg
    ## [ 25 / 64 ]  657.jpg
    ## [ 26 / 64 ]  658.jpg
    ## [ 27 / 64 ]  659.jpg
    ## [ 28 / 64 ]  660.jpg
    ## [ 29 / 64 ]  661.jpg
    ## [ 30 / 64 ]  665.jpg
    ## [ 31 / 64 ]  677.jpg
    ## [ 32 / 64 ]  678.jpg
    ## [ 33 / 64 ]  na49-1.jpg
    ## [ 34 / 64 ]  na49-10.jpg
    ## [ 35 / 64 ]  na49-11.jpg
    ## [ 36 / 64 ]  na49-12.jpg
    ## [ 37 / 64 ]  na49-13.jpg
    ## [ 38 / 64 ]  na49-137.jpg
    ## [ 39 / 64 ]  na49-14.jpg
    ## [ 40 / 64 ]  na49-149.jpg
    ## [ 41 / 64 ]  na49-176.jpg
    ## [ 42 / 64 ]  na49-187.jpg
    ## [ 43 / 64 ]  na49-195.jpg
    ## [ 44 / 64 ]  na49-2.jpg
    ## [ 45 / 64 ]  na49-271.jpg
    ## [ 46 / 64 ]  na49-3.jpg
    ## [ 47 / 64 ]  na49-33.jpg
    ## [ 48 / 64 ]  na49-4.jpg
    ## [ 49 / 64 ]  na49-5.jpg
    ## [ 50 / 64 ]  na49-587.jpg
    ## [ 51 / 64 ]  na49-616.jpg
    ## [ 52 / 64 ]  na49-7.jpg
    ## [ 53 / 64 ]  na49-734.jpg
    ## [ 54 / 64 ]  na49-8.jpg
    ## [ 55 / 64 ]  na49-9.jpg
    ## [ 56 / 64 ]  sy280-1.jpg
    ## [ 57 / 64 ]  sy280-2.jpg
    ## [ 58 / 64 ]  sy280-3.jpg
    ## [ 59 / 64 ]  sy43-1.jpg
    ## [ 60 / 64 ]  sy43-2.jpg
    ## [ 61 / 64 ]  sy43-3.jpg
    ## [ 62 / 64 ]  sy43-4.jpg
    ## [ 63 / 64 ]  sy43-5.jpg
    ## [ 64 / 64 ]  sy43-6.jpg

    ## Done in 8 secs

``` r
# add attributes
data.out <- Out(outlines, 
         fac = att.data)

# scale, align, rotate, and center specimens
norm.outlines <- data.out %>% 
  coo_scale() %>%
  coo_align() %>% 
  coo_center()
```

## Pile and mosaics

``` r
# outline pile
pile(norm.outlines)
```

<img src="efa-perdiz_files/figure-gfm/stack.panel-1.png" width="100%" />

``` r
# mosaic of individual specimens from the different sites
mosaic(norm.outlines, ~trinomial)
```

<img src="efa-perdiz_files/figure-gfm/stack.panel-2.png" width="100%" />

``` r
# mosaic of individual specimens rendered from different materials
mosaic(norm.outlines, ~raw.mat)
```

<img src="efa-perdiz_files/figure-gfm/stack.panel-3.png" width="100%" />

## Calibrate harmonic + EFA

``` r
# calibrate how many harmonics needed
calibrate_harmonicpower_efourier(norm.outlines, 
                                 nb.h = 30)
```

    ## $gg

<img src="efa-perdiz_files/figure-gfm/cal.harm-1.png" width="100%" />

    ## 
    ## $q
    ##                h1       h2       h3       h4       h5       h6       h7
    ## 489      72.80879 83.78198 95.17554 95.58620 96.94914 97.61501 97.95870
    ## 490      64.11472 71.74229 80.72420 89.12673 91.89527 97.25527 97.89054
    ## 553      60.22764 67.66112 78.47978 88.42469 91.97133 97.96056 98.60926
    ## 554      40.78402 62.70509 71.02441 88.80778 92.02025 97.18926 98.19496
    ## 555      71.88337 75.67063 83.98654 89.34967 91.27061 96.88514 98.02617
    ## 556      40.13167 62.71068 66.15981 84.78732 88.45546 94.74772 96.20115
    ## 558      63.01215 77.73567 90.06870 90.36598 91.90045 93.94937 94.75257
    ## 559      37.44023 60.66242 71.29934 86.72881 90.17083 96.07668 97.22067
    ## 562      60.69465 69.96634 77.12798 87.14123 90.12571 96.20471 97.29606
    ## 565      64.49327 80.33025 89.87705 90.69617 92.26710 94.75796 95.81031
    ## 591      32.41060 64.36665 71.82945 90.72323 94.12426 97.00883 98.55887
    ## 598      54.09519 69.79342 80.21895 91.62848 93.17747 97.30424 98.48432
    ## 645      37.43071 61.77266 70.12401 88.30539 92.41149 97.17813 98.23178
    ## 646      48.47206 67.04623 73.39793 90.58139 94.34818 96.89540 98.59301
    ## 647      63.96232 66.40189 73.20076 87.28925 92.34106 97.84810 98.43246
    ## 648      51.66189 60.75373 67.73491 84.11689 90.80362 96.67577 97.48979
    ## 649      13.19821 67.02359 73.20792 91.32686 96.27920 97.08839 97.94181
    ## 650      62.50056 67.69024 73.36673 89.73518 94.63252 98.08290 98.54933
    ## 651      25.86199 55.85938 68.03343 87.64255 92.73702 96.70377 98.18765
    ## 652      22.57648 60.60679 68.19757 89.37573 93.98487 96.56320 97.92897
    ## 653      53.50633 62.33004 70.77582 88.94387 93.68013 97.88528 98.55523
    ## 654      44.03121 66.31590 73.29146 91.93527 95.20683 97.46861 98.89531
    ## 655      53.16964 60.43443 64.83868 83.34328 89.55824 96.76372 97.87205
    ## 656      57.11047 63.11221 68.16400 82.60450 87.07412 95.61119 97.38995
    ## 657      44.15358 55.01196 61.02296 82.80466 87.94802 95.93126 97.01850
    ## 658      61.74901 65.60642 71.58815 87.75926 93.23432 98.24621 98.52779
    ## 659      50.93809 63.91895 68.76493 86.94809 89.69221 95.89946 97.42615
    ## 660      44.67350 62.32531 67.80680 90.92520 94.83023 96.73639 98.51319
    ## 661      48.31880 59.00113 64.26505 85.67911 90.52577 96.55592 97.60929
    ## 665      72.90414 75.33543 80.78979 88.20015 91.08371 97.41274 98.34543
    ## 677      43.62294 58.91874 66.48334 89.42983 93.54165 96.83488 98.47343
    ## 678      70.24771 71.42578 81.10140 86.84716 90.52952 96.31749 98.02421
    ## na49-1   31.92165 75.75622 77.75438 85.53597 87.68155 93.51100 93.95206
    ## na49-10  32.00825 69.77940 74.86502 86.55727 93.28558 96.86398 98.10591
    ## na49-11  42.20000 71.86912 76.35051 88.47760 90.84893 96.66611 97.98498
    ## na49-12  55.71231 71.83206 74.09161 84.99478 87.04896 93.82331 96.07732
    ## na49-13  48.81742 71.35210 75.64633 89.22010 90.63990 95.87327 97.22114
    ## na49-137 59.91738 70.02518 74.67464 88.09115 90.84073 95.48831 97.75657
    ## na49-14  25.82961 71.65096 74.27415 86.48891 86.92849 94.68605 96.81066
    ## na49-149 57.09476 64.48528 75.22863 85.24194 89.73042 96.76806 98.09828
    ## na49-176 24.05605 63.35709 71.43840 89.80090 93.76215 97.82298 98.51797
    ## na49-187 29.93967 74.40750 78.74296 90.81739 92.78665 96.75147 97.58693
    ## na49-195 39.68108 65.09278 74.90655 89.29705 92.30959 96.81509 97.92952
    ## na49-2   30.28071 68.17230 71.37316 86.65663 87.94489 95.16158 97.45114
    ## na49-271 60.29430 72.70936 78.78156 92.89525 94.86089 98.40826 98.98023
    ## na49-3   39.87487 66.73728 72.10141 86.91818 89.14735 95.90781 97.18568
    ## na49-33  41.31707 66.37250 74.33116 89.67273 92.61071 96.95974 98.11673
    ## na49-4   26.11997 71.01298 72.26403 83.56238 84.22867 89.26116 92.17965
    ## na49-5   37.55446 69.18960 75.29509 87.14672 91.91719 96.89021 98.17006
    ## na49-587 62.53317 74.12428 80.74202 91.72949 92.28497 97.36947 98.28266
    ## na49-616 69.72354 86.09821 91.30956 94.60831 95.15136 97.37226 98.34031
    ## na49-7   21.02472 65.80826 69.37707 86.89560 90.97629 96.72722 98.03434
    ## na49-734 57.18609 70.10897 78.07352 89.77037 91.38756 97.65835 98.65071
    ## na49-8   24.18414 67.02006 73.62160 89.73804 95.69156 98.01444 99.05675
    ## na49-9   61.27424 74.52665 80.51925 89.85001 91.42936 96.20940 97.55310
    ## sy280-1  49.45446 62.32477 73.86652 85.70561 92.10806 96.23968 97.52581
    ## sy280-2  71.22850 74.12065 81.29642 89.50642 91.61586 97.37249 98.30322
    ## sy280-3  57.69274 76.21813 81.49655 86.81075 89.23454 93.64286 95.48935
    ## sy43-1   46.22085 65.94746 78.00457 89.43500 92.72360 97.38535 98.02824
    ## sy43-2   24.33600 63.22271 74.18428 91.25984 94.29042 97.10462 98.11819
    ## sy43-3   25.00450 58.60052 70.02732 89.41425 95.07051 97.21588 98.18561
    ## sy43-4   47.10315 65.86668 75.70676 94.25650 96.85250 97.47922 99.16972
    ## sy43-5   47.01256 62.08855 71.39968 88.29861 91.17021 96.96058 97.85325
    ## sy43-6   41.25025 76.41672 79.61610 91.96321 92.75108 96.15273 97.42490
    ##                h8       h9      h10      h11      h12      h13      h14
    ## 489      98.99222 99.27944 99.61408 99.66292 99.67257 99.74548 99.77200
    ## 490      98.43317 98.90168 99.21067 99.26009 99.39885 99.47944 99.54422
    ## 553      99.03073 99.36751 99.44516 99.53735 99.61913 99.67585 99.71820
    ## 554      98.35599 98.99227 99.07903 99.18155 99.65220 99.70881 99.74345
    ## 555      99.22945 99.34429 99.35722 99.65024 99.70336 99.74050 99.84641
    ## 556      97.07108 98.32436 98.35603 98.48074 98.91994 99.09404 99.22256
    ## 558      97.47642 98.23127 99.15827 99.24117 99.41253 99.50428 99.56908
    ## 559      97.71586 98.44616 98.50390 98.65258 99.15941 99.41700 99.61239
    ## 562      98.57226 99.03098 99.22437 99.49559 99.52488 99.55208 99.75261
    ## 565      98.49869 99.02328 99.61277 99.62274 99.65681 99.75540 99.77200
    ## 591      98.61906 98.76021 99.38794 99.56447 99.69590 99.74709 99.77566
    ## 598      98.73772 99.23659 99.27576 99.30295 99.50219 99.52999 99.55235
    ## 645      98.46989 98.73442 98.95378 99.08073 99.40631 99.44517 99.47290
    ## 646      98.84265 99.02189 99.39947 99.48570 99.57729 99.68552 99.70816
    ## 647      98.57160 99.16726 99.23451 99.33657 99.54623 99.61790 99.66645
    ## 648      97.90301 98.89001 98.98484 99.05226 99.30660 99.42561 99.52725
    ## 649      98.50792 98.74961 99.32895 99.45088 99.48496 99.54428 99.68207
    ## 650      98.77696 99.31998 99.46525 99.56771 99.71114 99.72319 99.74218
    ## 651      98.36471 98.70513 99.13669 99.30682 99.42507 99.45162 99.50142
    ## 652      98.12207 98.20926 99.08563 99.26329 99.35190 99.43444 99.46619
    ## 653      98.78018 99.26962 99.35380 99.44214 99.64394 99.65243 99.71399
    ## 654      98.97063 99.04404 99.48813 99.58569 99.67358 99.74212 99.75227
    ## 655      98.10188 99.14485 99.17562 99.18710 99.55622 99.62697 99.74582
    ## 656      98.24966 99.07245 99.19652 99.44583 99.52592 99.55966 99.75749
    ## 657      97.71437 98.65702 98.74675 98.81958 99.36470 99.57875 99.72769
    ## 658      98.82481 99.43320 99.46738 99.50607 99.77579 99.82474 99.84460
    ## 659      98.12618 99.17514 99.18318 99.26235 99.62159 99.66360 99.70855
    ## 660      98.64637 98.72393 99.36060 99.56113 99.71252 99.74223 99.74241
    ## 661      98.05560 98.94426 98.98235 99.00026 99.45111 99.52906 99.58658
    ## 665      99.00547 99.29183 99.36726 99.57786 99.63159 99.67359 99.78074
    ## 677      98.69266 98.80843 99.14402 99.27266 99.54711 99.57613 99.60539
    ## 678      99.25218 99.33627 99.38623 99.56052 99.60291 99.61013 99.70996
    ## na49-1   96.45455 97.67232 98.82025 99.18009 99.24690 99.46825 99.50560
    ## na49-10  98.16499 98.66122 99.02378 99.19739 99.30166 99.57919 99.65491
    ## na49-11  98.33687 99.13666 99.17990 99.35672 99.48469 99.54577 99.66863
    ## na49-12  97.50756 98.11286 98.37351 99.07548 99.19511 99.27768 99.49350
    ## na49-13  98.46463 98.83135 98.85205 99.19195 99.22619 99.30331 99.45146
    ## na49-137 99.08951 99.21995 99.28047 99.38743 99.46698 99.52112 99.59822
    ## na49-14  97.19142 98.30435 98.38296 98.74302 98.91939 98.99713 99.18541
    ## na49-149 98.88719 99.14686 99.35429 99.45442 99.51308 99.59811 99.64661
    ## na49-176 98.66622 98.82294 99.06360 99.09015 99.13797 99.36106 99.52397
    ## na49-187 98.42608 98.77044 99.12634 99.23668 99.40085 99.44093 99.47351
    ## na49-195 98.22928 98.94052 99.02071 99.09363 99.47163 99.48354 99.51217
    ## na49-2   98.22426 98.71310 98.97968 99.01672 99.32761 99.38509 99.51621
    ## na49-271 99.15435 99.33773 99.45594 99.55950 99.77384 99.79261 99.80836
    ## na49-3   97.91435 98.68610 98.72109 99.03653 99.25363 99.42532 99.58646
    ## na49-33  98.17846 98.79069 98.89326 99.08333 99.49140 99.56867 99.61128
    ## na49-4   97.65624 98.27528 98.59534 98.85921 98.89302 99.01916 99.06482
    ## na49-5   98.55964 99.03843 99.12954 99.30570 99.35321 99.51407 99.56662
    ## na49-587 98.55538 99.29202 99.42066 99.56598 99.64220 99.71446 99.73503
    ## na49-616 98.54586 99.18812 99.41053 99.54191 99.58514 99.64289 99.70029
    ## na49-7   98.24096 98.80343 99.14321 99.19961 99.54526 99.56046 99.64805
    ## na49-734 98.99957 99.37450 99.44856 99.49435 99.56246 99.61164 99.65995
    ## na49-8   99.14584 99.18183 99.56418 99.57506 99.61390 99.65160 99.70296
    ## na49-9   98.67314 98.97961 99.11538 99.40651 99.45754 99.49952 99.58224
    ## sy280-1  98.69372 99.01226 99.24133 99.34778 99.55538 99.59281 99.70585
    ## sy280-2  98.72333 99.10224 99.22249 99.37691 99.45113 99.64142 99.72351
    ## sy280-3  97.76537 98.25908 98.57306 98.87464 99.21212 99.38738 99.51044
    ## sy43-1   98.32527 99.03189 99.04730 99.22250 99.30406 99.32061 99.35286
    ## sy43-2   98.14762 98.45102 99.05253 99.28210 99.46341 99.48374 99.60656
    ## sy43-3   98.47397 98.58611 99.30814 99.39358 99.46354 99.47819 99.56978
    ## sy43-4   99.20818 99.23503 99.59662 99.62793 99.64773 99.68214 99.73432
    ## sy43-5   98.27242 98.81727 98.83392 98.89115 99.19933 99.32798 99.40084
    ## sy43-6   98.46506 98.77542 99.01868 99.16444 99.31701 99.44385 99.57586
    ##               h15      h16      h17      h18      h19      h20      h21
    ## 489      99.80462 99.82192 99.82341 99.85272 99.87865 99.91085 99.92286
    ## 490      99.59587 99.62522 99.63711 99.71079 99.75015 99.75947 99.78940
    ## 553      99.75627 99.77140 99.78933 99.81395 99.83675 99.88522 99.89000
    ## 554      99.82060 99.82265 99.84003 99.88827 99.89508 99.90968 99.92937
    ## 555      99.86700 99.89300 99.92314 99.94175 99.96739 99.96955 99.97635
    ## 556      99.33403 99.42302 99.55630 99.59933 99.63249 99.66365 99.69817
    ## 558      99.72318 99.74806 99.78242 99.84868 99.86327 99.88367 99.90459
    ## 559      99.65349 99.69833 99.74681 99.79044 99.80719 99.82695 99.87185
    ## 562      99.77378 99.82801 99.85958 99.86190 99.88385 99.89866 99.90624
    ## 565      99.81405 99.84130 99.86763 99.88482 99.92366 99.94140 99.95881
    ## 591      99.78641 99.87133 99.87713 99.88817 99.92076 99.92919 99.94188
    ## 598      99.69048 99.74154 99.75481 99.81876 99.87467 99.87899 99.89069
    ## 645      99.55845 99.56258 99.59820 99.71182 99.76571 99.83101 99.88606
    ## 646      99.72993 99.80558 99.82420 99.83787 99.86296 99.89529 99.89981
    ## 647      99.73749 99.75055 99.76713 99.77742 99.84435 99.86703 99.88193
    ## 648      99.64522 99.65408 99.70820 99.73725 99.76721 99.84772 99.86568
    ## 649      99.72057 99.77413 99.79398 99.81656 99.84928 99.87351 99.88844
    ## 650      99.76137 99.77677 99.79153 99.81017 99.88066 99.88864 99.92889
    ## 651      99.52530 99.60766 99.64903 99.71442 99.72953 99.80386 99.82414
    ## 652      99.51808 99.67351 99.77700 99.78891 99.84286 99.85576 99.90064
    ## 653      99.78507 99.82541 99.84104 99.87795 99.89456 99.89757 99.90810
    ## 654      99.76880 99.82519 99.84526 99.85335 99.87885 99.89331 99.91234
    ## 655      99.74946 99.76780 99.77633 99.81093 99.85482 99.87491 99.91767
    ## 656      99.77316 99.80910 99.81796 99.84004 99.84539 99.89515 99.90107
    ## 657      99.75758 99.77069 99.78894 99.81597 99.84526 99.85987 99.87213
    ## 658      99.85641 99.86427 99.86832 99.91702 99.93080 99.94344 99.95814
    ## 659      99.81597 99.83027 99.84733 99.86700 99.87883 99.88528 99.90467
    ## 660      99.75423 99.80213 99.82431 99.83041 99.85408 99.87850 99.89197
    ## 661      99.67788 99.69162 99.70964 99.76618 99.81364 99.85320 99.88166
    ## 665      99.78648 99.80747 99.84066 99.85990 99.86897 99.90740 99.90987
    ## 677      99.62761 99.71459 99.77934 99.78599 99.82397 99.84851 99.87206
    ## 678      99.78256 99.78790 99.85325 99.87332 99.89596 99.90323 99.92267
    ## na49-1   99.58867 99.68925 99.70014 99.80666 99.83863 99.88422 99.90152
    ## na49-10  99.70450 99.73045 99.75402 99.81133 99.82763 99.84429 99.87931
    ## na49-11  99.84047 99.86786 99.88970 99.90204 99.91609 99.93014 99.95510
    ## na49-12  99.55157 99.72639 99.78198 99.83131 99.85924 99.87325 99.88727
    ## na49-13  99.54443 99.61270 99.69855 99.69977 99.71150 99.75562 99.81144
    ## na49-137 99.62066 99.63969 99.65111 99.72215 99.73381 99.76556 99.79850
    ## na49-14  99.34236 99.44893 99.59831 99.64282 99.76361 99.79531 99.87977
    ## na49-149 99.69352 99.78541 99.84634 99.88248 99.91437 99.92231 99.95873
    ## na49-176 99.67319 99.68010 99.73001 99.75973 99.79642 99.83086 99.90624
    ## na49-187 99.68415 99.78168 99.83741 99.84769 99.87852 99.89080 99.92207
    ## na49-195 99.59976 99.64113 99.70663 99.71657 99.71956 99.75289 99.78211
    ## na49-2   99.59243 99.62772 99.71078 99.74231 99.78089 99.80818 99.88260
    ## na49-271 99.82354 99.85375 99.86832 99.90313 99.92523 99.93118 99.94116
    ## na49-3   99.60133 99.63937 99.68460 99.69925 99.72650 99.77740 99.80549
    ## na49-33  99.71608 99.77418 99.83588 99.87833 99.89259 99.91315 99.93457
    ## na49-4   99.40704 99.47178 99.55538 99.69334 99.80467 99.81182 99.85112
    ## na49-5   99.65237 99.69561 99.80160 99.86378 99.89337 99.90237 99.90568
    ## na49-587 99.77075 99.80753 99.82222 99.85935 99.89005 99.89619 99.93590
    ## na49-616 99.74133 99.79057 99.81536 99.85495 99.86998 99.88882 99.90377
    ## na49-7   99.71932 99.80585 99.83990 99.87972 99.89885 99.91269 99.92842
    ## na49-734 99.75653 99.75847 99.76387 99.79304 99.81114 99.92302 99.92692
    ## na49-8   99.76698 99.77724 99.87514 99.88844 99.90300 99.92625 99.92979
    ## na49-9   99.60854 99.64665 99.74684 99.75592 99.78197 99.79599 99.82117
    ## sy280-1  99.71819 99.74437 99.77662 99.83560 99.86900 99.88567 99.91386
    ## sy280-2  99.76424 99.77236 99.83354 99.84523 99.85539 99.88729 99.90148
    ## sy280-3  99.56430 99.64785 99.71797 99.79901 99.80611 99.85098 99.86239
    ## sy43-1   99.48668 99.52264 99.58077 99.67710 99.72289 99.78047 99.82846
    ## sy43-2   99.66863 99.73299 99.79936 99.84140 99.85450 99.87693 99.88396
    ## sy43-3   99.57570 99.78380 99.80247 99.80670 99.82052 99.84624 99.85006
    ## sy43-4   99.74999 99.79038 99.82204 99.84457 99.85298 99.86771 99.87493
    ## sy43-5   99.44954 99.47751 99.50633 99.58821 99.61362 99.66500 99.69424
    ## sy43-6   99.65545 99.67076 99.77371 99.82869 99.83647 99.87026 99.87682
    ##               h22      h23      h24      h25      h26      h27      h28 h29
    ## 489      99.94669 99.96596 99.98339 99.98504 99.99251 99.99371 99.99574 100
    ## 490      99.82367 99.86219 99.92748 99.93455 99.96848 99.98226 99.99078 100
    ## 553      99.92227 99.92644 99.93262 99.94819 99.97288 99.98151 99.98828 100
    ## 554      99.94159 99.94846 99.96047 99.97359 99.97812 99.98289 99.98863 100
    ## 555      99.97732 99.98256 99.98329 99.99026 99.99125 99.99440 99.99454 100
    ## 556      99.72227 99.73924 99.75857 99.78090 99.83743 99.87875 99.97544 100
    ## 558      99.90700 99.92415 99.93280 99.97915 99.98029 99.98517 99.99161 100
    ## 559      99.89070 99.93852 99.94821 99.96116 99.97516 99.98627 99.99001 100
    ## 562      99.93707 99.94290 99.95298 99.95893 99.97706 99.97944 99.99213 100
    ## 565      99.96587 99.98508 99.98571 99.98634 99.99102 99.99496 99.99815 100
    ## 591      99.95569 99.96000 99.96944 99.97262 99.98283 99.98986 99.99933 100
    ## 598      99.90750 99.93148 99.94348 99.97319 99.97965 99.99165 99.99538 100
    ## 645      99.91024 99.91251 99.92711 99.93754 99.94735 99.96603 99.96636 100
    ## 646      99.94561 99.94999 99.95108 99.96046 99.96673 99.97721 99.98563 100
    ## 647      99.92977 99.95002 99.95551 99.97231 99.97771 99.97981 99.99703 100
    ## 648      99.89290 99.92611 99.92919 99.94981 99.96239 99.98568 99.99734 100
    ## 649      99.90363 99.90763 99.93084 99.94448 99.96397 99.97705 99.98854 100
    ## 650      99.95128 99.95697 99.95804 99.97550 99.97808 99.98663 99.99276 100
    ## 651      99.83815 99.86617 99.91585 99.92272 99.96878 99.97907 99.98814 100
    ## 652      99.93449 99.93964 99.94659 99.96045 99.96570 99.97796 99.97914 100
    ## 653      99.92429 99.94213 99.94952 99.96145 99.96616 99.97349 99.98101 100
    ## 654      99.93124 99.94158 99.94476 99.95093 99.97372 99.98650 99.99498 100
    ## 655      99.92153 99.93546 99.95328 99.96402 99.97827 99.98215 99.98870 100
    ## 656      99.90748 99.93264 99.93569 99.95801 99.96491 99.98486 99.99717 100
    ## 657      99.90453 99.93306 99.95702 99.97221 99.97408 99.99000 99.99282 100
    ## 658      99.95937 99.96680 99.97460 99.98321 99.98500 99.99520 99.99921 100
    ## 659      99.91397 99.94898 99.95854 99.96858 99.97314 99.98438 99.99169 100
    ## 660      99.91011 99.92247 99.94037 99.95445 99.97124 99.97581 99.98600 100
    ## 661      99.88563 99.89367 99.91834 99.93786 99.95715 99.98864 99.99733 100
    ## 665      99.92833 99.94610 99.95185 99.96528 99.97796 99.98729 99.99499 100
    ## 677      99.93771 99.93980 99.94562 99.95115 99.96424 99.97163 99.99565 100
    ## 678      99.93005 99.94635 99.95250 99.96118 99.96790 99.97532 99.98628 100
    ## na49-1   99.90197 99.94039 99.95503 99.96759 99.98265 99.98984 99.99578 100
    ## na49-10  99.88753 99.90734 99.92515 99.96325 99.97924 99.98510 99.98697 100
    ## na49-11  99.95657 99.97070 99.97670 99.98140 99.98451 99.98913 99.99190 100
    ## na49-12  99.91265 99.94840 99.95312 99.95864 99.96498 99.97056 99.98881 100
    ## na49-13  99.85720 99.87345 99.90148 99.95668 99.97321 99.99154 99.99945 100
    ## na49-137 99.81846 99.84424 99.89305 99.90915 99.93604 99.98938 99.99026 100
    ## na49-14  99.90482 99.92006 99.93709 99.96363 99.97659 99.98393 99.98739 100
    ## na49-149 99.96652 99.97270 99.98040 99.98155 99.98611 99.99312 99.99612 100
    ## na49-176 99.91260 99.93432 99.94517 99.95465 99.96049 99.96126 99.97201 100
    ## na49-187 99.93864 99.95063 99.96758 99.96803 99.97416 99.98138 99.98618 100
    ## na49-195 99.82358 99.84438 99.88792 99.91604 99.92064 99.94309 99.95514 100
    ## na49-2   99.88967 99.89568 99.91398 99.93808 99.95293 99.97808 99.98214 100
    ## na49-271 99.95023 99.95216 99.97499 99.98525 99.98845 99.99064 99.99264 100
    ## na49-3   99.84766 99.89457 99.92044 99.94020 99.94424 99.95690 99.96683 100
    ## na49-33  99.94325 99.95337 99.96294 99.96943 99.97707 99.99016 99.99569 100
    ## na49-4   99.88363 99.95167 99.95890 99.96510 99.97008 99.98047 99.98425 100
    ## na49-5   99.91976 99.93122 99.94867 99.95923 99.96765 99.98365 99.99612 100
    ## na49-587 99.94077 99.96291 99.97080 99.97320 99.97783 99.98534 99.99196 100
    ## na49-616 99.96474 99.97384 99.97807 99.98293 99.98640 99.98900 99.99244 100
    ## na49-7   99.94160 99.95027 99.95228 99.97195 99.97524 99.98917 99.99208 100
    ## na49-734 99.94009 99.94203 99.94873 99.96239 99.96684 99.97085 99.98374 100
    ## na49-8   99.94108 99.94756 99.95298 99.95660 99.96851 99.97842 99.98293 100
    ## na49-9   99.86234 99.90818 99.94009 99.94050 99.96258 99.97436 99.98670 100
    ## sy280-1  99.93589 99.95382 99.97265 99.97769 99.98204 99.98996 99.99351 100
    ## sy280-2  99.93395 99.95776 99.96352 99.96627 99.97836 99.98958 99.99468 100
    ## sy280-3  99.87782 99.89044 99.91573 99.92701 99.95461 99.96967 99.99444 100
    ## sy43-1   99.84229 99.90353 99.92195 99.96092 99.97615 99.98011 99.99584 100
    ## sy43-2   99.91210 99.91382 99.92558 99.93448 99.96269 99.97418 99.98035 100
    ## sy43-3   99.90051 99.92044 99.92298 99.92661 99.94411 99.94958 99.96480 100
    ## sy43-4   99.87747 99.88767 99.89083 99.92617 99.92981 99.95776 99.97538 100
    ## sy43-5   99.77953 99.85879 99.90130 99.94575 99.96713 99.96909 99.98476 100
    ## sy43-6   99.87994 99.90496 99.92155 99.93196 99.95897 99.97879 99.99709 100
    ## 
    ## $minh
    ##   90%   95%   99% 99.9% 
    ##     6     7    11    22

``` r
# 11 harmonics needed to capture 99 percent of variation
calibrate_reconstructions_efourier(norm.outlines, 
                                   range = 1:11)
```

<img src="efa-perdiz_files/figure-gfm/cal.harm-2.png" width="100%" />

``` r
# generate efa outlines with 11 harmonics
efa.outlines <- efourier(norm.outlines, 
                         nb.h = 11, 
                         norm = TRUE)

# use efa.outlines for pca
pca.outlines <- PCA(efa.outlines)
```

## PCA

``` r
# pca 
scree_plot(pca.outlines)
```

<img src="efa-perdiz_files/figure-gfm/pca.plot-1.png" width="100%" />

``` r
# plot pca by site
plot_PCA(pca.outlines, 
         morphospace_position = "range",
         ~trinomial, zoom = 1.25)
```

<img src="efa-perdiz_files/figure-gfm/pca.plot-2.png" width="100%" />

``` r
# plot pca by raw material
plot_PCA(pca.outlines, 
         morphospace_position = "range",
         ~raw.mat, zoom = 1.25)
```

<img src="efa-perdiz_files/figure-gfm/pca.plot-3.png" width="100%" />

``` r
# contribution of each pc
# by site
boxplot(pca.outlines, ~trinomial, nax = 1:5)
```

<img src="efa-perdiz_files/figure-gfm/pca.plot-4.png" width="100%" />

``` r
# by raw material
boxplot(pca.outlines, ~raw.mat, nax = 1:5)
```

<img src="efa-perdiz_files/figure-gfm/pca.plot-5.png" width="100%" />

``` r
# mean shape + 2sd for the first 10 pcs
PCcontrib(pca.outlines, nax = 1:5)
```

<img src="efa-perdiz_files/figure-gfm/pca.plot-6.png" width="100%" />

## MANOVA + MANOVA\_PW

``` r
# manova

# shape difference between sites?
MANOVA(pca.outlines, 'trinomial')
```

    ## PC axes 1 to 16 were retained

    ##           Df Hotelling-Lawley approx F num Df den Df    Pr(>F)    
    ## fac        5           4.7543   2.4604     80    207 1.565e-07 ***
    ## Residuals 58                                                      
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

``` r
# which differ?
MANOVA_PW(pca.outlines, 'trinomial')
```

    ## '41sy280' has 3 rows, and 'retain' is set accordingly

    ## PC axes 1 to 3 were retained

    ## 41cp1241cp20

    ## 41cp1241cp5

    ## 41cp1241na49

    ## 41cp1241sy280

    ## 41cp1241sy43

    ## 41cp2041cp5

    ## 41cp2041na49

    ## 41cp2041sy280

    ## 41cp2041sy43

    ## 41cp541na49

    ## 41cp541sy280

    ## 41cp541sy43

    ## 41na4941sy280

    ## 41na4941sy43

    ## 41sy28041sy43

    ## $stars.tab
    ##         41cp12 41cp20 41cp5 41na49 41sy280 41sy43
    ## 41cp12         *      ***   *      *       **    
    ## 41cp20                -     *      .       -     
    ## 41cp5                       ***    ***     .     
    ## 41na49                             *       -     
    ## 41sy280                                    *     
    ## 
    ## $summary (see also $manovas)
    ##                  Df  Pillai approx F num Df den Df    Pr(>F)
    ## 41cp12 - 41cp20   1 0.60586   5.1238      3     10 2.108e-02
    ## 41cp12 - 41cp5    1 0.48685   7.5901      3     24 9.739e-04
    ## 41cp12 - 41na49   1 0.28745   3.8996      3     29 1.865e-02
    ## 41cp12 - 41sy280  1 0.64718   5.5030      3      9 2.007e-02
    ## 41cp12 - 41sy43   1 0.59842   5.9606      3     12 9.954e-03
    ## 41cp20 - 41cp5    1 0.08865   0.5836      3     18 6.334e-01
    ## 41cp20 - 41na49   1 0.35342   4.1906      3     23 1.667e-02
    ## 41cp20 - 41sy280  1 0.90199   9.2028      3      3 5.053e-02
    ## 41cp20 - 41sy43   1 0.25610   0.6885      3      6 5.913e-01
    ## 41cp5 - 41na49    1 0.54881  15.0018      3     37 1.510e-06
    ## 41cp5 - 41sy280   1 0.64349  10.2284      3     17 4.412e-04
    ## 41cp5 - 41sy43    1 0.30930   2.9853      3     20 5.563e-02
    ## 41na49 - 41sy280  1 0.37029   4.3123      3     22 1.550e-02
    ## 41na49 - 41sy43   1 0.14975   1.4677      3     25 2.473e-01
    ## 41sy280 - 41sy43  1 0.81856   7.5190      3      5 2.665e-02

``` r
# shape difference between raw.mat?
MANOVA(pca.outlines, 'raw.mat')
```

    ## PC axes 1 to 16 were retained

    ##           Df Hotelling-Lawley approx F num Df den Df  Pr(>F)  
    ## fac        3           1.7708    1.611     48    131 0.01801 *
    ## Residuals 60                                                  
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

``` r
# which differ?
MANOVA_PW(pca.outlines, 'raw.mat')
```

    ## 'jasper' has 10 rows, and 'retain' is set accordingly

    ## PC axes 1 to 10 were retained

    ## chertjasper

    ## chertquartzite

    ## cherts.wd

    ## jasperquartzite

    ## jaspers.wd

    ## quartzites.wd

    ## $stars.tab
    ##           chert jasper quartzite s.wd
    ## chert           -      -         .   
    ## jasper                 .         *** 
    ## quartzite                        *   
    ## 
    ## $summary (see also $manovas)
    ##                    Df Pillai approx F num Df den Df    Pr(>F)
    ## chert - jasper      1 0.5397    1.876     10     16 0.1262628
    ## chert - quartzite   1 0.3642    1.031     10     18 0.4572907
    ## chert - s.wd        1 0.3985    2.054     10     31 0.0611796
    ## jasper - quartzite  1 0.6826    2.366     10     11 0.0869372
    ## jasper - s.wd       1 0.7196    6.159     10     24 0.0001304
    ## quartzite - s.wd    1 0.4731    2.334     10     26 0.0402848

## Mean shapes

``` r
# mean shapes

# site
ms.2 <- MSHAPES(efa.outlines, ~trinomial)
plot_MSHAPES(ms.2, size = 0.75)
```

<img src="efa-perdiz_files/figure-gfm/ms1-1.png" width="100%" />

``` r
# raw material
ms.3 <- MSHAPES(efa.outlines, ~raw.mat)
plot_MSHAPES(ms.3, size = 0.75)
```

<img src="efa-perdiz_files/figure-gfm/ms1-2.png" width="100%" />
